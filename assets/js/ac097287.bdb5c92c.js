/*! For license information please see ac097287.bdb5c92c.js.LICENSE.txt */
"use strict";(self.webpackChunkcromagnoli_portfolio=self.webpackChunkcromagnoli_portfolio||[]).push([[754],{8443(e,t,r){r.r(t),r.d(t,{assets:()=>Oe,contentTitle:()=>He,default:()=>Fe,frontMatter:()=>Ge,metadata:()=>n,toc:()=>Me});const n=JSON.parse('{"id":"case-studies/progressive-rollout-legacy","title":"Progressive Rollout from Legacy to NextGen Stack (Hybrid Routing)","description":"Summary","source":"@site/docs/case-studies/progressive-rollout-legacy.mdx","sourceDirName":"case-studies","slug":"/case-studies/progressive-rollout-legacy","permalink":"/cromagnoli/case-studies/progressive-rollout-legacy","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var a=r(4848),o=r(8453),i=r(2444),s=r(467),c=r(3845),l=r(6540);const u="card_L5Cs",d="sectionBlock_auDm",h="cardHeader_q076",f="cardBody_xHj7",m="modeHero_iEAx",g="playgroundModeHero_QwF8",p="stickyModeHero_y0xM",v="modeHeroTopRow_FZHQ",x="modeControlRow_gQqa",y="modeHeroLabel_TD8l",b="sectionLabel_Wl6j",j="modeHeroActiveLabel_hXj_",N="modeHeroActiveLabelNextGen_f62k",w="modeHeroActiveLabelLegacy__UDX",S="modeHeroBodyText_zoN1",_="failureCta_Ih2C",R="modeSwitch_Esq4",k="modeThumb_Gdf1",T="modeSwitchLegacy_HKPw",P="modeState_MB_3",L="modeSwitchWrap_y6CE",C="modeSwitchLoading_NXoe",G="modeTooltip_uRis",H="modeTooltipText_WltG",O="logsPanel_ApRo",M="code-block_JmQ_",E="codeBlockTitle_zwrx",F="codeBlockHint_WVzS",A="error-note_jCrx",I="spinner_KhFb",U="iframeWrapper_AAhA",D="recoveryOverlay_Vm16",q="recoveryContent_erWw",B="recoverySwapIcon_NqNl",W="recoveryText_UgZh",V="recoverySubtext__MsQ",Q="externalPostForm_VatD",K="browserChrome_vcXh",z="browserTopBar_tzPr",X="browserLeft_wKum",Z="browserControls_Wsph",J="trafficLights_IwL8",Y="browserTab_PnXM",$="tabSpinner_xOsb",ee="tabBuyMeNotIcon_oSQk",te="light_vfSi",re="red_tVLN",ne="yellow_j3VV",ae="green_wtLH",oe="browserStatus_o1AG",ie="backButton_i819",se="reloadButton_Gh6d",ce="addressRow_hpRP",le="postFormRow__Kog",ue="postFeedback_rjxm",de="address_tlkU",he="copyButton_thX4",fe="copyButtonCopied_kMLK",me="addressHint_ci4m",ge="spinning_nK14",pe="previewFrame_SQ0B",ve="iframeCode_ZGpY",xe="iframeCodeTitle_zSol",ye="iframeCodeHint_WrQe",be="iframeCodePre_d8RM";var je="running-sneakers",Ne="white-loop-runner",we="prod1234",Se="https://hybrid-routing-demo.onrender.com",_e=function(){if("undefined"==typeof window)return Se;var e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"http://localhost:4001":Se}(),Re=function(e){var t=new URL(_e+"/pdp/"+je+"/"+Ne+"/"+we+"/");return t.searchParams.set("demoSessionId",e),t.toString()},ke=function(e){var t=new URL(_e+"/cdp/"+je+"/"+Ne+"/"+we+"/");return t.searchParams.set("demoSessionId",e),t.toString()},Te=function(e){return e.length>12e3?e.slice(0,12e3)+"\n\x3c!-- truncated --\x3e":e},Pe=function(e){var t,r,n=e.match(/<title[^>]*>([\s\S]*?)<\/title>/i);return null!=(t=null==n||null==(r=n[1])?void 0:r.trim())?t:""},Le=function(e){var t=new Date(e);return Number.isNaN(t.getTime())?e:new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}).format(t)};const Ce=function(){var e=(0,l.useState)("nextgen"),t=e[0],r=e[1],n=(0,l.useState)(!1),o=n[0],je=n[1],Ne=(0,l.useState)("White Loop Runner"),Se=Ne[0],Ce=Ne[1],Ge=(0,l.useState)(!0),He=Ge[0],Oe=Ge[1],Me=(0,l.useState)(!1),Ee=Me[0],Fe=Me[1],Ae=(0,l.useState)(0),Ie=Ae[0],Ue=Ae[1],De=(0,l.useState)(!1),qe=De[0],Be=De[1],We=(0,l.useState)("Waiting for iframe load..."),Ve=We[0],Qe=We[1],Ke=(0,l.useState)(""),ze=Ke[0],Xe=Ke[1],Ze=(0,l.useState)(""),Je=Ze[0],Ye=Ze[1],$e=(0,l.useState)(!1),et=$e[0],tt=$e[1],rt=(0,l.useState)([]),nt=rt[0],at=rt[1],ot=(0,l.useState)("Ready. Submit Product Name, then reload the embedded page to verify server-side updates."),it=ot[0],st=ot[1],ct=(0,l.useState)(null),lt=ct[0],ut=ct[1],dt=(0,l.useState)(!1),ht=dt[0],ft=dt[1],mt=(0,l.useState)(null),gt=mt[0],pt=mt[1],vt=(0,l.useRef)(0),xt=(0,l.useMemo)(function(){return"doc-"+Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)},[]),yt=(0,l.useState)(function(){return ke(xt)}),bt=yt[0],jt=yt[1];(0,l.useEffect)(function(){var e=!1;ft(!0),pt(null);var t=new URL(_e+"/resolve/"+we);return t.searchParams.set("demoSessionId",xt),t.searchParams.set("legacy","false"),fetch(t.toString()).then(function(e){if(!e.ok)throw new Error("Server unreachable");return e.json()}).then(function(t){e||(ut(t),"string"==typeof t.productName&&t.productName.trim()&&Ce(t.productName),"nextgen"!==t.routingMode&&"legacy"!==t.routingMode||r(t.routingMode),"boolean"==typeof t.simulateFailure&&je(t.simulateFailure),ft(!1))}).catch(function(){e||(pt("Hybrid routing service unreachable."),ut(null),ft(!1))}),function(){e=!0}},[Ie,xt]);var Nt=(0,l.useMemo)(function(){return null!=lt&&lt.queryLegacy?"Legacy forced via ?legacy=true":null!=lt&&lt.fallback?"Legacy fallback after NextGen error":"nextgen"===(null==lt?void 0:lt.route)?"NextGen - React Router/Remix (Reactive UI)":"Hapi legacy controller (postback)"},[lt]),wt=(0,l.useMemo)(function(){var e="legacy"===(null==lt?void 0:lt.route)||(null==lt?void 0:lt.fallback)||(null==lt?void 0:lt.queryLegacy);return j+" "+(e?w:N)},[lt]),St=(0,l.useMemo)(function(){if(nt.length>0){for(var e,t=[],r=nt.slice(-12),n=(0,c.A)(r);!(e=n()).done;){var a,o=e.value;if("SESSION_END"!==o.marker)if("SESSION_BEGINNING"!==o.marker){var i=Le(o.at);t.push(i+" \xb7 "+o.method+" "+o.path+" \xb7 route="+o.route+" reason="+o.reason+" fallback="+(o.fallback?"yes":"no"))}else{var s;t.push("[SESSION "+(null!=(s=o.sessionId)?s:"unknown")+"] ---------")}else t.push("[SESSION "+(null!=(a=o.sessionId)?a:"unknown")+"] ---------")}return t}return lt?lt.queryLegacy?["Routing hint: ?legacy=true present \u2192 skip NextGen.","Invoking listings.singleListing via Hapi."]:lt.fallback?["NextGen routing activated but a runtime error surfaced.","Resolver falls back to the legacy Hapi handler (notFound fallback)."]:"nextgen"===lt.route?["NextGen routing active \u2192 hitting React Router 7 entrypoint.","viteDevServerSingleton reused; manifest injected on demand."]:["Feature flag disabled \u2192 legacy Hapi controller handles the route."]:["Waiting for the routing service to respond..."]},[lt,nt]),_t=(0,l.useRef)(null),Rt=(0,l.useRef)(null),kt=(0,l.useRef)(null),Tt=(0,l.useRef)(!0),Pt=(0,l.useMemo)(function(){return new URL(_e).origin},[]);(0,l.useEffect)(function(){return function(){kt.current&&clearTimeout(kt.current)}},[]),(0,l.useEffect)(function(){var e=Rt.current;e&&Tt.current&&(e.scrollTop=e.scrollHeight)},[St]);(0,l.useEffect)(function(){var e=!1,t=function(){var t=new URL(_e+"/routing-events");t.searchParams.set("after",String(vt.current)),fetch(t.toString()).then(function(e){if(!e.ok)throw new Error("events unavailable");return e.json()}).then(function(t){if(!e&&Array.isArray(t.events)&&0!==t.events.length){at(function(e){return[].concat(e,t.events).slice(-40)});var r=t.events[t.events.length-1];r&&"number"==typeof r.id?vt.current=r.id:"number"==typeof t.latestId&&(vt.current=t.latestId)}}).catch(function(){})};t();var r=window.setInterval(t,1200);return function(){e=!0,window.clearInterval(r)}},[]);var Lt=Je||bt,Ct=(0,l.useMemo)(function(){try{return new URL(Lt).pathname.includes("/cdp/")}catch(e){return!1}},[Lt]),Gt=(0,l.useMemo)(function(){try{return new URL(Lt).pathname.includes("/pdp/")}catch(e){return!1}},[Lt]),Ht=(0,l.useMemo)(function(){try{return"true"===new URL(Lt).searchParams.get("legacy")}catch(e){return!1}},[Lt]),Ot=Gt&&!Ht&&"nextgen"===t&&"nextgen"===(null==lt?void 0:lt.route)&&!(null!=lt&&lt.queryLegacy)&&!(null!=lt&&lt.fallback),Mt=ze||(Ct?"Category Detail":"Product Detail"),Et=He&&o&&Gt,Ft=(0,l.useMemo)(function(){var e=new URL(bt);return e.searchParams.set("__reload",String(Ie)),e.toString()},[bt,Ie]),At=(0,l.useMemo)(function(){var e=new URL(bt);return e.searchParams.delete("demoSessionId"),e.searchParams.delete("__reload"),e.searchParams.delete("routingMode"),e.toString()},[bt]),It=function(){var e=(0,s.A)((0,i.A)().m(function e(t){var r,n,a;return(0,i.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return t.preventDefault(),r=Se.trim()||"White Loop Runner",n=Re(xt),Fe(!0),e.p=1,a=new URLSearchParams({productName:r}),e.n=2,fetch(n,{method:"POST",body:a});case 2:if(e.v.ok){e.n=3;break}throw new Error("POST failed");case 3:Ce(r),st("POST accepted. Click reload to apply in the iframe."),e.n=5;break;case 4:e.p=4,e.v,st("POST failed. Check service availability.");case 5:return e.p=5,Fe(!1),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(t){return e.apply(this,arguments)}}();(0,l.useEffect)(function(){var e=function(e){var t;if(e.source===(null==(t=_t.current)?void 0:t.contentWindow)){var r=new URL(At).origin;if(e.origin===Pt||e.origin===r){var n=e.data;if("IFRAME_NAVIGATION_START"!==(null==n?void 0:n.type)){if("IFRAME_HTML_SNAPSHOT"===(null==n?void 0:n.type)){"string"==typeof n.href&&n.href&&Ye(n.href);var a="string"==typeof n.html?n.html:"";if(a){var o=Pe(a);o&&Xe(o),Qe(Te(a))}}}else Oe(!0)}}};return window.addEventListener("message",e),function(){return window.removeEventListener("message",e)}},[Pt,At]);var Ut=function(){var e=(0,s.A)((0,i.A)().m(function e(){return(0,i.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,navigator.clipboard.writeText(At);case 1:Be(!0),setTimeout(function(){return Be(!1)},1200),e.n=3;break;case 2:e.p=2,e.v,Be(!1);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}(),Dt=function(){var e=(0,s.A)((0,i.A)().m(function e(){var n,a,o;return(0,i.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return r(n="nextgen"===t?"legacy":"nextgen"),Fe(!0),st("Updating routing mode to "+n+" via POST..."),e.p=1,a=Re(xt),o=new URLSearchParams({routingMode:n}),e.n=2,fetch(a,{method:"POST",body:o});case 2:if(e.v.ok){e.n=3;break}throw new Error("POST failed");case 3:tt(!0),kt.current&&clearTimeout(kt.current),kt.current=setTimeout(function(){return tt(!1)},1e4),st("Routing mode updated to "+n+". Click reload to apply in iframe."),e.n=5;break;case 4:e.p=4,e.v,r(function(e){return"nextgen"===e?"legacy":"nextgen"}),st("Routing mode POST failed. Check service availability.");case 5:return e.p=5,Fe(!1),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(){return e.apply(this,arguments)}}(),qt=function(){var e=(0,s.A)((0,i.A)().m(function e(){var t,r,n;return(0,i.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return Fe(!0),Oe(!0),st("Triggering NextGen failure via POST..."),e.p=1,t=function(){try{var e=new URL(Je);if(e.pathname.includes("/pdp/"))return e.searchParams.set("demoSessionId",xt),e.searchParams.delete("legacy"),e.searchParams.delete("fallbackReason"),e.toString()}catch(t){}return Re(xt)}(),r=Re(xt),n=new URLSearchParams({simulateFailure:"true"}),e.n=2,fetch(r,{method:"POST",body:n});case 2:if(e.v.ok){e.n=3;break}throw new Error("POST failed");case 3:jt(t),je(!0),Ue(function(e){return e+1}),st("Failure trigger accepted. Reloading iframe..."),e.n=5;break;case 4:e.p=4,e.v,Oe(!1),st("Failure trigger POST failed. Check service availability.");case 5:return e.p=5,Fe(!1),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(){return e.apply(this,arguments)}}();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:u,children:[(0,a.jsx)("div",{className:h,children:"Live User Flow Test Playground"}),(0,a.jsxs)("div",{className:m+" "+g+" "+p,children:[(0,a.jsx)("div",{className:v,children:(0,a.jsx)("div",{className:y,children:"NextGen Rollout Feature Flag Switch for Product Detail Page"})}),(0,a.jsxs)("div",{className:x,children:[(0,a.jsxs)("div",{className:L,children:[et?(0,a.jsx)("div",{className:G,children:(0,a.jsx)("span",{className:H,children:"If you are on the product detail page, use the embedded browser reload button to reload the current page with the selected renderer."})}):null,(0,a.jsxs)("button",{type:"button",className:R+" "+("legacy"===t?T:"")+" "+(Ee?C:""),onClick:Dt,"aria-label":"Toggle product detail page routing mode",title:"Toggle product detail page routing mode",disabled:Ee,children:[(0,a.jsx)("span",{className:P,children:"nextgen"===t?"ON":"OFF"}),(0,a.jsx)("span",{className:k})]})]}),(0,a.jsxs)("div",{className:wt,children:["Current experience: ",Nt]})]})]}),(0,a.jsxs)("div",{className:f,children:[gt?(0,a.jsx)("div",{className:A,children:gt}):null,(0,a.jsxs)("div",{className:U,children:[(0,a.jsx)("div",{className:K,children:(0,a.jsxs)("div",{className:z,children:[(0,a.jsxs)("div",{className:X,children:[(0,a.jsxs)("div",{className:Z,children:[(0,a.jsxs)("div",{className:J,"aria-hidden":"true",children:[(0,a.jsx)("span",{className:te+" "+re}),(0,a.jsx)("span",{className:te+" "+ne}),(0,a.jsx)("span",{className:te+" "+ae})]}),(0,a.jsxs)("div",{className:oe,children:[(0,a.jsx)("button",{type:"button",className:ie,onClick:function(){Ee||Ct||(Oe(!0),jt(ke(xt)),st("Navigated back to category page."))},title:"Back to category",disabled:Ee||Ct,children:(0,a.jsx)("svg",{viewBox:"0 0 16 16","aria-hidden":"true",focusable:"false",children:(0,a.jsx)("path",{d:"M9.75 3.25L4.25 8l5.5 4.75v-2.75h3v-4h-3z"})})}),(0,a.jsx)("button",{type:"button",className:se,onClick:function(){if(!Ee){var e=Je||bt;jt(function(){try{var r=new URL(e);return"nextgen"===t&&(r.searchParams.delete("legacy"),r.searchParams.delete("fallbackReason")),r.toString()}catch(n){return e}}),Oe(!0),Ue(function(e){return e+1})}},title:"Reload",disabled:Ee||He,children:"\u27f3"})]})]}),(0,a.jsxs)("div",{className:Y,"aria-hidden":"true",children:[He?(0,a.jsx)("span",{className:$+" "+ge}):(0,a.jsx)("span",{className:ee,children:"B"}),Mt]})]}),(0,a.jsxs)("div",{className:ce,children:[(0,a.jsx)("code",{className:de,children:At}),(0,a.jsx)("button",{type:"button",className:he+" "+(qe?fe:""),onClick:Ut,title:"Copy address",children:qe?"\u2713 Copied":"Copy address"})]}),(0,a.jsx)("div",{className:me,children:"Optionally, copy this URL to test the route manually in a new tab."})]})}),Et?(0,a.jsx)("div",{className:D,"aria-live":"polite",children:(0,a.jsxs)("div",{className:q,children:[(0,a.jsx)("span",{className:B,"aria-hidden":"true",children:"\u21b9"}),(0,a.jsx)("span",{className:W,children:"Switching experience..."}),(0,a.jsx)("span",{className:V,children:"Your data is safe."})]})}):null,(0,a.jsx)("iframe",{ref:_t,className:pe,src:Ft,onLoad:function(){var e,t,r;Oe(!1),(r=null!=(e=null==(t=_t.current)?void 0:t.contentWindow)?e:null)&&r.postMessage({type:"REQUEST_HTML_SNAPSHOT"},"*");try{var n,a,o,i=null==(n=_t.current)||null==(n=n.contentWindow)||null==(n=n.location)?void 0:n.href;i&&Ye(i);var s=null==(a=_t.current)||null==(a=a.contentDocument)?void 0:a.title;s&&Xe(s);var c=null==(o=_t.current)||null==(o=o.contentDocument)||null==(o=o.documentElement)?void 0:o.outerHTML;if(!c)return void Qe("Unable to read iframe HTML.");var l=Pe(c);l&&Xe(l),Qe(Te(c))}catch(u){Qe("Cross-origin iframe: waiting for postMessage HTML snapshot...")}},title:"Progressive routing preview"},Ft)]})]})]}),(0,a.jsxs)("div",{className:m+" "+d,children:[(0,a.jsx)("div",{className:v,children:(0,a.jsx)("div",{className:b,children:"Simulate NextGen failure"})}),(0,a.jsx)("div",{className:S,children:"This flow is resilient by design: when NextGen fails, an error boundary redirects to legacy rendering to minimize user friction."}),(0,a.jsxs)("div",{className:x,children:[(0,a.jsx)("button",{type:"button",className:_,disabled:!Ot||Ee||He,onClick:qt,children:o?"Failure triggered \ud83d\udd25":"Trigger failure \ud83d\udca5"}),Ot?null:(0,a.jsx)("div",{className:S,children:"Disabled until the iframe is on NextGen product detail."})]})]}),(0,a.jsxs)("div",{className:m+" "+d,children:[(0,a.jsx)("div",{className:v,children:(0,a.jsx)("div",{className:b,children:"Live Server Data Editing (REST)"})}),(0,a.jsx)("div",{className:S,children:"Use this control to verify that both renderers consume the same server-side source of truth. Submit an update, then reload the embedded page to confirm consistent data across legacy and NextGen."}),(0,a.jsxs)("form",{className:Q,onSubmit:It,children:[(0,a.jsxs)("div",{className:le,children:[(0,a.jsx)("input",{id:"pdp-name",value:Se,onChange:function(e){return Ce(e.target.value)}}),(0,a.jsx)("button",{type:"submit",disabled:He,children:Ee?"Posting...":"POST to server"})]}),(0,a.jsx)("div",{className:ue,children:it})]})]}),(0,a.jsxs)("div",{className:ve,children:[(0,a.jsx)("div",{className:xe,children:"Current iframe HTML"}),(0,a.jsx)("div",{className:ye,children:"Inspect the raw HTML payload returned by the active server renderer before client-side processing. Look for runtime markers such as Vite scripts to validate which stack served the page."}),(0,a.jsx)("pre",{className:be,children:Ve})]}),ht?(0,a.jsx)("div",{className:I,children:"Fetching routing state..."}):(0,a.jsxs)("div",{className:O,children:[(0,a.jsx)("div",{className:E,children:"Server Log"}),(0,a.jsx)("div",{className:F,children:"Validate routing decisions by tracking which renderer served each request and, if applicable, why fallback happened."}),(0,a.jsx)("div",{ref:Rt,className:M,onScroll:function(){var e=Rt.current;if(e){var t=e.scrollHeight-e.scrollTop-e.clientHeight;Tt.current=t<24}},children:St.map(function(e){return(0,a.jsx)("div",{children:e},e)})})]})]})},Ge={},He="Progressive Rollout from Legacy to NextGen Stack (Hybrid Routing)",Oe={},Me=[{value:"Summary",id:"summary",level:2},{value:"How to Run the Experience",id:"how-to-run-the-experience",level:2},{value:"What the Solution Includes",id:"what-the-solution-includes",level:2},{value:"Key Code",id:"key-code",level:2}];function Ee(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"progressive-rollout-from-legacy-to-nextgen-stack-hybrid-routing",children:"Progressive Rollout from Legacy to NextGen Stack (Hybrid Routing)"})}),"\n",(0,a.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsxs)(t.p,{children:["This case study documents how the team unified ",(0,a.jsx)(t.code,{children:"routing.resolveRouteController(listings.singleListing, '/pdp/{productCategory}/{productName}/{productId}')"})," so one route can run on both React Router 7 (NextGen) and the legacy Hapi server."]}),"\n",(0,a.jsx)(t.h2,{id:"how-to-run-the-experience",children:"How to Run the Experience"}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsx)(t.li,{children:"The iframe starts on a legacy product category page with a product thumbnail."}),"\n",(0,a.jsx)(t.li,{children:"Click the product to open the product detail page. At that point, the resolver decides NextGen vs legacy based on the NextGen ON/OFF switch state."}),"\n",(0,a.jsxs)(t.li,{children:["Toggle ",(0,a.jsx)(t.code,{children:"NextGen ON/OFF"}),", then press ",(0,a.jsx)(t.code,{children:"Reload"})," in the simulated browser to apply the change to the iframe."]}),"\n",(0,a.jsxs)(t.li,{children:["Try ",(0,a.jsx)(t.code,{children:"Product Name (external POST)"}),": submit the change, then use ",(0,a.jsx)(t.code,{children:"Reload"})," to verify the server-side update in the embedded page."]}),"\n",(0,a.jsxs)(t.li,{children:["Enable ",(0,a.jsx)(t.code,{children:"Trigger failure \ud83d\udd25"})," (NextGen only), reload, and confirm automatic fallback to legacy in the server log (forced by error boundary)."]}),"\n",(0,a.jsxs)(t.li,{children:["Optionally, use ",(0,a.jsx)(t.code,{children:"Copy address"})," and open the URL in a new tab to validate the same behavior outside the iframe."]}),"\n"]}),"\n",(0,a.jsx)(Ce,{}),"\n",(0,a.jsx)(t.h2,{id:"what-the-solution-includes",children:"What the Solution Includes"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Single decorator"})," (",(0,a.jsx)(t.code,{children:"resolveRouteController"}),") that intercepts the request and decides modern vs legacy flow."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Feature-flag gating"})," (",(0,a.jsx)(t.code,{children:"routingModeFeatureFlag"}),") plus NextGen signals (",(0,a.jsx)(t.code,{children:"nextGen.isRoutingActive"}),") so only allowed pages route through RR7."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Transparent fallback"}),": ",(0,a.jsx)(t.code,{children:"?legacy=true"})," and RR7 failures both force the legacy path to preserve route reliability."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Operational visibility"}),": manifest injection and fallback route decisions are logged."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"key-code",children:"Key Code"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",children:"export const resolveRouteController = (legacyController: ServerRoute, pathDebugId: string) => ({\n  ...legacyController,\n  handler: async (request, h) => {\n    if (shouldUseNextGenRouter(request)) {\n      const reactRouterRoutesHandler = await getReactRouterRoutesHandler(request);\n      return reactRouterRoutesHandler(request, h);\n    }\n\n    return legacyController.handler?.(request, h);\n  }\n});\n\nexport const shouldUseNextGenRouter = (request: FsboRequest): boolean => {\n  const isNextGenEnabled = nextGen.isRoutingActive(request);\n  const nextGenEnabledPages = ['ListingsEdit', 'Detail2', 'BrandNewPage', 'DevPlayground'];\n  return (\n    isNextGenEnabled &&\n    canRouteViaNextGen(request.path, nextGenEnabledPages)\n  );\n};\n"})})]})}function Fe(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(Ee,{...e})}):Ee(e)}},467(e,t,r){function n(e,t,r,n,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function a(e){return function(){var t=this,r=arguments;return new Promise(function(a,o){var i=e.apply(t,r);function s(e){n(i,a,o,s,c,"next",e)}function c(e){n(i,a,o,s,c,"throw",e)}s(void 0)})}}r.d(t,{A:()=>a})},2444(e,t,r){function n(e,t,r,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}n=function(e,t,r,a){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!a,configurable:!a,writable:!a}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,a)}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function s(r,a,o,i){var s=a&&a.prototype instanceof l?a:l,u=Object.create(s.prototype);return n(u,"_invoke",function(r,n,a){var o,i,s,l=0,u=a||[],d=!1,h={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return o=t,i=0,s=e,h.n=r,c}};function f(r,n){for(i=r,s=n,t=0;!d&&l&&!a&&t<u.length;t++){var a,o=u[t],f=h.p,m=o[2];r>3?(a=m===n)&&(s=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=f&&((a=r<2&&f<o[1])?(i=0,h.v=n,h.n=o[1]):f<m&&(a=r<3||o[0]>n||n>m)&&(o[4]=r,o[5]=n,h.n=m,i=0))}if(a||r>1)return c;throw d=!0,n}return function(a,u,m){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&f(u,m),i=u,s=m;(t=i<2?e:s)||!d;){o||(i?i<3?(i>1&&(h.n=-1),f(i,s)):h.n=s:h.v=s);try{if(l=2,o){if(i||(a="next"),t=o[a]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=o.return)&&t.call(o),i<2&&(s=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((t=(d=h.n<0)?s:r.call(n,h))!==c)break}catch(t){o=e,i=1,s=t}finally{l=1}}return{value:t,done:d}}}(r,o,i),!0),u}var c={};function l(){}function u(){}function d(){}t=Object.getPrototypeOf;var h=[][o]?t(t([][o]())):(n(t={},o,function(){return this}),t),f=d.prototype=l.prototype=Object.create(h);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=d,n(f,"constructor",d),n(d,"constructor",u),u.displayName="GeneratorFunction",n(d,i,"GeneratorFunction"),n(f),n(f,i,"Generator"),n(f,o,function(){return this}),n(f,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:m}})()}r.d(t,{A:()=>a})},8453(e,t,r){r.d(t,{R:()=>i,x:()=>s});var n=r(6540);const a={},o=n.createContext(a);function i(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);