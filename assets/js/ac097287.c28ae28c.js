/*! For license information please see ac097287.c28ae28c.js.LICENSE.txt */
"use strict";(self.webpackChunkcromagnoli_portfolio=self.webpackChunkcromagnoli_portfolio||[]).push([[754],{2509(e,r,t){t.r(r),t.d(r,{assets:()=>Ie,contentTitle:()=>Fe,default:()=>Ue,frontMatter:()=>Me,metadata:()=>n,toc:()=>Oe});const n=JSON.parse('{"id":"case-studies/progressive-rollout-legacy","title":"Progressive Rollout from Legacy to NextGen Stack (Hybrid Routing)","description":"Modernize without freezing delivery or risking route uptime.","source":"@site/docs/case-studies/progressive-rollout-legacy.mdx","sourceDirName":"case-studies","slug":"/case-studies/progressive-rollout-legacy","permalink":"/cromagnoli/case-studies/progressive-rollout-legacy","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Stateless Configurable Modal API","permalink":"/cromagnoli/case-studies/stateless-configurable-modal-api"},"next":{"title":"Transactional Email Framework","permalink":"/cromagnoli/case-studies/transactional-email"}}');var i=t(4848),a=t(8453),o=t(2444),s=t(467),l=t(3845),c=t(6540);const d="card_L5Cs",u="sectionBlock_auDm",h="cardHeader_q076",p="cardBody_xHj7",m="modeHero_iEAx",g="playgroundModeHero_QwF8",v="stickyModeHero_y0xM",f="modeHeroTopRow_FZHQ",x="modeControlRow_gQqa",y="modeHeroLabel_TD8l",b="sectionLabel_Wl6j",j="modeHeroActiveLabel_hXj_",w="modeHeroActiveLabelNextGen_f62k",N="modeHeroActiveLabelLegacy__UDX",R="modeHeroBodyText_zoN1",S="failureCta_Ih2C",k="modeSwitch_Esq4",_="modeThumb_Gdf1",T="modeSwitchLegacy_HKPw",L="modeState_MB_3",P="modeSwitchWrap_y6CE",C="modeSwitchLoading_NXoe",E="modeTooltip_uRis",H="modeTooltipText_WltG",G="logsPanel_ApRo",A="code-block_JmQ_",q="codeBlockTitle_zwrx",M="codeBlockHint_WVzS",F="error-note_jCrx",I="spinner_KhFb",O="iframeWrapper_AAhA",D="recoveryOverlay_Vm16",U="recoveryContent_erWw",W="recoverySwapIcon_NqNl",B="recoveryText_UgZh",V="recoverySubtext__MsQ",Q="externalPostForm_VatD",z="browserChrome_vcXh",K="browserTopBar_tzPr",X="browserLeft_wKum",J="browserControls_Wsph",Y="trafficLights_IwL8",Z="browserTab_PnXM",$="tabSpinner_xOsb",ee="tabBuyMeNotIcon_oSQk",re="light_vfSi",te="red_tVLN",ne="yellow_j3VV",ie="green_wtLH",ae="browserStatus_o1AG",oe="backButton_i819",se="reloadButton_Gh6d",le="addressRow_hpRP",ce="postFormRow__Kog",de="postFeedback_rjxm",ue="address_tlkU",he="copyButton_thX4",pe="copyButtonCopied_kMLK",me="addressHint_ci4m",ge="spinning_nK14",ve="previewFrame_SQ0B",fe="iframeCode_ZGpY",xe="iframeCodeTitle_zSol",ye="iframeCodeHint_WrQe",be="iframeCodePre_d8RM";var je="running-sneakers",we="white-loop-runner",Ne="prod1234",Re="https://hybrid-routing-demo.onrender.com",Se=function(){if("undefined"==typeof window)return Re;var e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"http://localhost:4001":Re}(),ke=function(e){var r=new URL(Se+"/pdp/"+je+"/"+we+"/"+Ne+"/");return r.searchParams.set("demoSessionId",e),r.toString()},_e=function(e){var r=new URL(Se+"/cdp/"+je+"/"+we+"/"+Ne+"/");return r.searchParams.set("demoSessionId",e),r.toString()},Te=function(e){return e.length>12e3?e.slice(0,12e3)+"\n\x3c!-- truncated --\x3e":e},Le=function(e){var r,t,n=e.match(/<title[^>]*>([\s\S]*?)<\/title>/i);return null!=(r=null==n||null==(t=n[1])?void 0:t.trim())?r:""},Pe=function(e){var r=new Date(e);return Number.isNaN(r.getTime())?e:new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}).format(r)};const Ce=function(){var e=(0,c.useState)("nextgen"),r=e[0],t=e[1],n=(0,c.useState)(!1),a=n[0],je=n[1],we=(0,c.useState)("White Loop Runner"),Re=we[0],Ce=we[1],Ee=(0,c.useState)(!0),He=Ee[0],Ge=Ee[1],Ae=(0,c.useState)(!1),qe=Ae[0],Me=Ae[1],Fe=(0,c.useState)(0),Ie=Fe[0],Oe=Fe[1],De=(0,c.useState)(!1),Ue=De[0],We=De[1],Be=(0,c.useState)("Waiting for iframe load..."),Ve=Be[0],Qe=Be[1],ze=(0,c.useState)(""),Ke=ze[0],Xe=ze[1],Je=(0,c.useState)(""),Ye=Je[0],Ze=Je[1],$e=(0,c.useState)(!1),er=$e[0],rr=$e[1],tr=(0,c.useState)([]),nr=tr[0],ir=tr[1],ar=(0,c.useState)("Ready. Submit Product Name, then reload the embedded page to verify server-side updates."),or=ar[0],sr=ar[1],lr=(0,c.useState)(null),cr=lr[0],dr=lr[1],ur=(0,c.useState)(!1),hr=ur[0],pr=ur[1],mr=(0,c.useState)(null),gr=mr[0],vr=mr[1],fr=(0,c.useRef)(0),xr=(0,c.useMemo)(function(){return"doc-"+Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8)},[]),yr=(0,c.useState)(function(){return _e(xr)}),br=yr[0],jr=yr[1];(0,c.useEffect)(function(){var e=!1;pr(!0),vr(null);var r=new URL(Se+"/resolve/"+Ne);return r.searchParams.set("demoSessionId",xr),r.searchParams.set("legacy","false"),fetch(r.toString()).then(function(e){if(!e.ok)throw new Error("Server unreachable");return e.json()}).then(function(r){e||(dr(r),"string"==typeof r.productName&&r.productName.trim()&&Ce(r.productName),"nextgen"!==r.routingMode&&"legacy"!==r.routingMode||t(r.routingMode),"boolean"==typeof r.simulateFailure&&je(r.simulateFailure),pr(!1))}).catch(function(){e||(vr("Hybrid routing service unreachable."),dr(null),pr(!1))}),function(){e=!0}},[Ie,xr]);var wr=(0,c.useMemo)(function(){return null!=cr&&cr.queryLegacy?"Legacy forced via ?legacy=true":null!=cr&&cr.fallback?"Legacy fallback after NextGen error":"nextgen"===(null==cr?void 0:cr.route)?"NextGen - React Router/Remix (Reactive UI)":"Hapi legacy controller (postback)"},[cr]),Nr=(0,c.useMemo)(function(){var e="legacy"===(null==cr?void 0:cr.route)||(null==cr?void 0:cr.fallback)||(null==cr?void 0:cr.queryLegacy);return j+" "+(e?N:w)},[cr]),Rr=(0,c.useMemo)(function(){if(nr.length>0){for(var e,r=[],t=nr.slice(-12),n=(0,l.A)(t);!(e=n()).done;){var i,a=e.value;if("SESSION_END"!==a.marker)if("SESSION_BEGINNING"!==a.marker){var o=Pe(a.at);r.push(o+" \xb7 "+a.method+" "+a.path+" \xb7 route="+a.route+" reason="+a.reason+" fallback="+(a.fallback?"yes":"no"))}else{var s;r.push("[SESSION "+(null!=(s=a.sessionId)?s:"unknown")+"] ---------")}else r.push("[SESSION "+(null!=(i=a.sessionId)?i:"unknown")+"] ---------")}return r}return cr?cr.queryLegacy?["Routing hint: ?legacy=true present \u2192 skip NextGen.","Invoking listings.singleListing via Hapi."]:cr.fallback?["NextGen routing activated but a runtime error surfaced.","Resolver falls back to the legacy Hapi handler (notFound fallback)."]:"nextgen"===cr.route?["NextGen routing active \u2192 hitting React Router 7 entrypoint.","viteDevServerSingleton reused; manifest injected on demand."]:["Feature flag disabled \u2192 legacy Hapi controller handles the route."]:["Waiting for the routing service to respond..."]},[cr,nr]),Sr=(0,c.useRef)(null),kr=(0,c.useRef)(null),_r=(0,c.useRef)(null),Tr=(0,c.useRef)(!0),Lr=(0,c.useMemo)(function(){return new URL(Se).origin},[]);(0,c.useEffect)(function(){return function(){_r.current&&clearTimeout(_r.current)}},[]),(0,c.useEffect)(function(){var e=kr.current;e&&Tr.current&&(e.scrollTop=e.scrollHeight)},[Rr]);(0,c.useEffect)(function(){var e=!1,r=function(){var r=new URL(Se+"/routing-events");r.searchParams.set("after",String(fr.current)),fetch(r.toString()).then(function(e){if(!e.ok)throw new Error("events unavailable");return e.json()}).then(function(r){if(!e&&Array.isArray(r.events)&&0!==r.events.length){ir(function(e){return[].concat(e,r.events).slice(-40)});var t=r.events[r.events.length-1];t&&"number"==typeof t.id?fr.current=t.id:"number"==typeof r.latestId&&(fr.current=r.latestId)}}).catch(function(){})};r();var t=window.setInterval(r,1200);return function(){e=!0,window.clearInterval(t)}},[]);var Pr=Ye||br,Cr=(0,c.useMemo)(function(){try{return new URL(Pr).pathname.includes("/cdp/")}catch(e){return!1}},[Pr]),Er=(0,c.useMemo)(function(){try{return new URL(Pr).pathname.includes("/pdp/")}catch(e){return!1}},[Pr]),Hr=(0,c.useMemo)(function(){try{return"true"===new URL(Pr).searchParams.get("legacy")}catch(e){return!1}},[Pr]),Gr=Er&&!Hr&&"nextgen"===r&&"nextgen"===(null==cr?void 0:cr.route)&&!(null!=cr&&cr.queryLegacy)&&!(null!=cr&&cr.fallback),Ar=Ke||(Cr?"Category Detail":"Product Detail"),qr=He&&a&&Er,Mr=(0,c.useMemo)(function(){var e=new URL(br);return e.searchParams.set("__reload",String(Ie)),e.toString()},[br,Ie]),Fr=(0,c.useMemo)(function(){var e=new URL(br);return e.searchParams.delete("demoSessionId"),e.searchParams.delete("__reload"),e.searchParams.delete("routingMode"),e.toString()},[br]),Ir=function(){var e=(0,s.A)((0,o.A)().m(function e(r){var t,n,i;return(0,o.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return r.preventDefault(),t=Re.trim()||"White Loop Runner",n=ke(xr),Me(!0),e.p=1,i=new URLSearchParams({productName:t}),e.n=2,fetch(n,{method:"POST",body:i});case 2:if(e.v.ok){e.n=3;break}throw new Error("POST failed");case 3:Ce(t),sr("POST accepted. Click reload to apply in the iframe."),e.n=5;break;case 4:e.p=4,e.v,sr("POST failed. Check service availability.");case 5:return e.p=5,Me(!1),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(r){return e.apply(this,arguments)}}();(0,c.useEffect)(function(){var e=function(e){var r;if(e.source===(null==(r=Sr.current)?void 0:r.contentWindow)){var t=new URL(Fr).origin;if(e.origin===Lr||e.origin===t){var n=e.data;if("IFRAME_NAVIGATION_START"!==(null==n?void 0:n.type)){if("IFRAME_HTML_SNAPSHOT"===(null==n?void 0:n.type)){"string"==typeof n.href&&n.href&&Ze(n.href);var i="string"==typeof n.html?n.html:"";if(i){var a=Le(i);a&&Xe(a),Qe(Te(i))}}}else Ge(!0)}}};return window.addEventListener("message",e),function(){return window.removeEventListener("message",e)}},[Lr,Fr]);var Or=function(){var e=(0,s.A)((0,o.A)().m(function e(){return(0,o.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,navigator.clipboard.writeText(Fr);case 1:We(!0),setTimeout(function(){return We(!1)},1200),e.n=3;break;case 2:e.p=2,e.v,We(!1);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}(),Dr=function(){var e=(0,s.A)((0,o.A)().m(function e(){var n,i,a;return(0,o.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return t(n="nextgen"===r?"legacy":"nextgen"),Me(!0),sr("Updating routing mode to "+n+" via POST..."),e.p=1,i=ke(xr),a=new URLSearchParams({routingMode:n}),e.n=2,fetch(i,{method:"POST",body:a});case 2:if(e.v.ok){e.n=3;break}throw new Error("POST failed");case 3:rr(!0),_r.current&&clearTimeout(_r.current),_r.current=setTimeout(function(){return rr(!1)},1e4),sr("Routing mode updated to "+n+". Click reload to apply in iframe."),e.n=5;break;case 4:e.p=4,e.v,t(function(e){return"nextgen"===e?"legacy":"nextgen"}),sr("Routing mode POST failed. Check service availability.");case 5:return e.p=5,Me(!1),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(){return e.apply(this,arguments)}}(),Ur=function(){var e=(0,s.A)((0,o.A)().m(function e(){var r,t,n;return(0,o.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return Me(!0),Ge(!0),sr("Triggering NextGen failure via POST..."),e.p=1,r=function(){try{var e=new URL(Ye);if(e.pathname.includes("/pdp/"))return e.searchParams.set("demoSessionId",xr),e.searchParams.delete("legacy"),e.searchParams.delete("fallbackReason"),e.toString()}catch(r){}return ke(xr)}(),t=ke(xr),n=new URLSearchParams({simulateFailure:"true"}),e.n=2,fetch(t,{method:"POST",body:n});case 2:if(e.v.ok){e.n=3;break}throw new Error("POST failed");case 3:jr(r),je(!0),Oe(function(e){return e+1}),sr("Failure trigger accepted. Reloading iframe..."),e.n=5;break;case 4:e.p=4,e.v,Ge(!1),sr("Failure trigger POST failed. Check service availability.");case 5:return e.p=5,Me(!1),e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}));return function(){return e.apply(this,arguments)}}();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:d,children:[(0,i.jsx)("div",{className:h,children:"Live User Flow Test Playground"}),(0,i.jsxs)("div",{className:m+" "+g+" "+v,children:[(0,i.jsx)("div",{className:f,children:(0,i.jsx)("div",{className:y,children:"NextGen Rollout Feature Flag Switch for Product Detail Page"})}),(0,i.jsxs)("div",{className:x,children:[(0,i.jsxs)("div",{className:P,children:[er?(0,i.jsx)("div",{className:E,children:(0,i.jsx)("span",{className:H,children:"If you are on the product detail page, use the embedded browser reload button to reload the current page with the selected renderer."})}):null,(0,i.jsxs)("button",{type:"button",className:k+" "+("legacy"===r?T:"")+" "+(qe?C:""),onClick:Dr,"aria-label":"Toggle product detail page routing mode",title:"Toggle product detail page routing mode",disabled:qe,children:[(0,i.jsx)("span",{className:L,children:"nextgen"===r?"ON":"OFF"}),(0,i.jsx)("span",{className:_})]})]}),(0,i.jsxs)("div",{className:Nr,children:["Current experience: ",wr]})]})]}),(0,i.jsxs)("div",{className:p,children:[gr?(0,i.jsx)("div",{className:F,children:gr}):null,(0,i.jsxs)("div",{className:O,children:[(0,i.jsx)("div",{className:z,children:(0,i.jsxs)("div",{className:K,children:[(0,i.jsxs)("div",{className:X,children:[(0,i.jsxs)("div",{className:J,children:[(0,i.jsxs)("div",{className:Y,"aria-hidden":"true",children:[(0,i.jsx)("span",{className:re+" "+te}),(0,i.jsx)("span",{className:re+" "+ne}),(0,i.jsx)("span",{className:re+" "+ie})]}),(0,i.jsxs)("div",{className:ae,children:[(0,i.jsx)("button",{type:"button",className:oe,onClick:function(){qe||Cr||(Ge(!0),jr(_e(xr)),sr("Navigated back to category page."))},title:"Back to category",disabled:qe||Cr,children:(0,i.jsx)("svg",{viewBox:"0 0 16 16","aria-hidden":"true",focusable:"false",children:(0,i.jsx)("path",{d:"M9.75 3.25L4.25 8l5.5 4.75v-2.75h3v-4h-3z"})})}),(0,i.jsx)("button",{type:"button",className:se,onClick:function(){if(!qe){var e=Ye||br;jr(function(){try{var t=new URL(e);return"nextgen"===r&&(t.searchParams.delete("legacy"),t.searchParams.delete("fallbackReason")),t.toString()}catch(n){return e}}),Ge(!0),Oe(function(e){return e+1})}},title:"Reload",disabled:qe||He,children:"\u27f3"})]})]}),(0,i.jsxs)("div",{className:Z,"aria-hidden":"true",children:[He?(0,i.jsx)("span",{className:$+" "+ge}):(0,i.jsx)("span",{className:ee,children:"B"}),Ar]})]}),(0,i.jsxs)("div",{className:le,children:[(0,i.jsx)("code",{className:ue,children:Fr}),(0,i.jsx)("button",{type:"button",className:he+" "+(Ue?pe:""),onClick:Or,title:"Copy address",children:Ue?"\u2713 Copied":"Copy address"})]}),(0,i.jsx)("div",{className:me,children:"Optionally, copy this URL to test the route manually in a new tab."})]})}),qr?(0,i.jsx)("div",{className:D,"aria-live":"polite",children:(0,i.jsxs)("div",{className:U,children:[(0,i.jsx)("span",{className:W,"aria-hidden":"true",children:"\u21b9"}),(0,i.jsx)("span",{className:B,children:"Switching experience..."}),(0,i.jsx)("span",{className:V,children:"Your data is safe."})]})}):null,(0,i.jsx)("iframe",{ref:Sr,className:ve,src:Mr,onLoad:function(){var e,r,t;Ge(!1),(t=null!=(e=null==(r=Sr.current)?void 0:r.contentWindow)?e:null)&&t.postMessage({type:"REQUEST_HTML_SNAPSHOT"},"*");try{var n,i,a,o=null==(n=Sr.current)||null==(n=n.contentWindow)||null==(n=n.location)?void 0:n.href;o&&Ze(o);var s=null==(i=Sr.current)||null==(i=i.contentDocument)?void 0:i.title;s&&Xe(s);var l=null==(a=Sr.current)||null==(a=a.contentDocument)||null==(a=a.documentElement)?void 0:a.outerHTML;if(!l)return void Qe("Unable to read iframe HTML.");var c=Le(l);c&&Xe(c),Qe(Te(l))}catch(d){Qe("Cross-origin iframe: waiting for postMessage HTML snapshot...")}},title:"Progressive routing preview"},Mr)]})]})]}),(0,i.jsxs)("div",{className:m+" "+u,children:[(0,i.jsx)("div",{className:f,children:(0,i.jsx)("div",{className:b,children:"Simulate NextGen failure"})}),(0,i.jsx)("div",{className:R,children:"This flow is resilient by design: when NextGen fails, an error boundary redirects to legacy rendering to minimize user friction."}),(0,i.jsxs)("div",{className:x,children:[(0,i.jsx)("button",{type:"button",className:S,disabled:!Gr||qe||He,onClick:Ur,children:a?"Failure triggered \ud83d\udd25":"Trigger failure \ud83d\udca5"}),Gr?null:(0,i.jsx)("div",{className:R,children:"Disabled until the iframe is on NextGen product detail."})]})]}),(0,i.jsxs)("div",{className:m+" "+u,children:[(0,i.jsx)("div",{className:f,children:(0,i.jsx)("div",{className:b,children:"Live Server Data Editing (REST)"})}),(0,i.jsx)("div",{className:R,children:"Use this control to verify that both renderers consume the same server-side source of truth. Submit an update, then reload the embedded page to confirm consistent data across legacy and NextGen."}),(0,i.jsxs)("form",{className:Q,onSubmit:Ir,children:[(0,i.jsxs)("div",{className:ce,children:[(0,i.jsx)("input",{id:"pdp-name",value:Re,onChange:function(e){return Ce(e.target.value)}}),(0,i.jsx)("button",{type:"submit",disabled:He,children:qe?"Posting...":"POST to server"})]}),(0,i.jsx)("div",{className:de,children:or})]})]}),(0,i.jsxs)("div",{className:fe,children:[(0,i.jsx)("div",{className:xe,children:"Current iframe HTML"}),(0,i.jsx)("div",{className:ye,children:"Inspect the raw HTML payload returned by the active server renderer before client-side processing. Look for runtime markers such as Vite scripts to validate which stack served the page."}),(0,i.jsx)("pre",{className:be,children:Ve})]}),hr?(0,i.jsx)("div",{className:I,children:"Fetching routing state..."}):(0,i.jsxs)("div",{className:G,children:[(0,i.jsx)("div",{className:q,children:"Server Log"}),(0,i.jsx)("div",{className:M,children:"Validate routing decisions by tracking which renderer served each request and, if applicable, why fallback happened."}),(0,i.jsx)("div",{ref:kr,className:A,onScroll:function(){var e=kr.current;if(e){var r=e.scrollHeight-e.scrollTop-e.clientHeight;Tr.current=r<24}},children:Rr.map(function(e){return(0,i.jsx)("div",{children:e},e)})})]})]})},Ee="header_YYTX",He="box_imL1",Ge="path_hG54",Ae="link_hAKV";const qe=function(e){var r=e.path,t=e.href;return(0,i.jsx)("div",{className:Ee,children:(0,i.jsxs)("div",{className:He,children:[(0,i.jsx)("span",{className:Ge,children:r}),(0,i.jsx)("a",{className:Ae,href:t,target:"_blank",rel:"noreferrer noopener",children:"View Source on GitHub"})]})})},Me={},Fe="Progressive Rollout from Legacy to NextGen Stack (Hybrid Routing)",Ie={},Oe=[{value:"Summary",id:"summary",level:2},{value:"Problem to Solve",id:"problem-to-solve",level:2},{value:"Main Risks Covered",id:"main-risks-covered",level:2},{value:"Architectural Approach",id:"architectural-approach",level:2},{value:"End-to-End Request Flow",id:"end-to-end-request-flow",level:2},{value:"Key Files (Entry Point to Runtime)",id:"key-files-entry-point-to-runtime",level:2},{value:"1) Route registration entry",id:"1-route-registration-entry",level:3},{value:"2) Core hybrid resolver",id:"2-core-hybrid-resolver",level:3},{value:"2.1) Main entry point (<code>resolveRouteController</code>)",id:"21-main-entry-point-resolveroutecontroller",level:4},{value:"2.2) Eligibility gate used by the resolver",id:"22-eligibility-gate-used-by-the-resolver",level:4},{value:"3) Hapi \u2194 React Router adapter",id:"3-hapi--react-router-adapter",level:3},{value:"3.1) Runtime handler bridge",id:"31-runtime-handler-bridge",level:4},{value:"3.2) Hapi request/response adapter",id:"32-hapi-requestresponse-adapter",level:4},{value:"4) Vite runtime service layer",id:"4-vite-runtime-service-layer",level:3},{value:"5) Route capability map",id:"5-route-capability-map",level:3},{value:"Resilience Design",id:"resilience-design",level:2},{value:"Resilience in Code",id:"resilience-in-code",level:3},{value:"1) Explicit operator fallback short-circuit",id:"1-explicit-operator-fallback-short-circuit",level:4},{value:"2) NextGen runtime failure boundary -&gt; legacy redirect",id:"2-nextgen-runtime-failure-boundary---legacy-redirect",level:4},{value:"Why JavaScript (No TypeScript) in This Case",id:"why-javascript-no-typescript-in-this-case",level:2},{value:"Product Value",id:"product-value",level:2},{value:"Performance Notes",id:"performance-notes",level:2},{value:"Live Demo",id:"live-demo",level:2},{value:"How to Run the Experience",id:"how-to-run-the-experience",level:3}];function De(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"progressive-rollout-from-legacy-to-nextgen-stack-hybrid-routing",children:"Progressive Rollout from Legacy to NextGen Stack (Hybrid Routing)"})}),"\n",(0,i.jsx)(r.admonition,{title:"Core Objective",type:"info",children:(0,i.jsx)(r.p,{children:"Modernize without freezing delivery or risking route uptime."})}),"\n",(0,i.jsx)(r.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(r.p,{children:"This case study shows a production-style migration strategy where one URL can be served by either a legacy Hapi controller or a NextGen React Router runtime, with controlled rollout and safe fallback."}),"\n",(0,i.jsx)(r.admonition,{type:"note",children:(0,i.jsxs)(r.p,{children:["This implementation is intentionally documented in JavaScript (",(0,i.jsx)(r.code,{children:".mjs"}),") instead of TypeScript to mirror the legacy codebase constraints and keep the architecture representation faithful to the original production pattern. ",(0,i.jsx)(r.a,{href:"#why-javascript-no-typescript-in-this-case",children:"More details"}),"."]})}),"\n",(0,i.jsx)(r.admonition,{title:"Live Demo Available",type:"tip",children:(0,i.jsxs)(r.p,{children:["Short on time? Jump directly to the ",(0,i.jsx)(r.a,{href:"#live-demo",children:"interactive demo"}),"."]})}),"\n",(0,i.jsx)(r.h2,{id:"problem-to-solve",children:"Problem to Solve"}),"\n",(0,i.jsx)(r.p,{children:"We needed to ship a modern stack incrementally while keeping legacy pages stable and revenue-safe."}),"\n",(0,i.jsx)(r.p,{children:"We needed surgical control over rollout blast radius:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Existing URLs could not change."}),"\n",(0,i.jsx)(r.li,{children:"Legacy had to remain the source of safety."}),"\n",(0,i.jsx)(r.li,{children:"Rollout had to be reversible instantly."}),"\n",(0,i.jsx)(r.li,{children:"Failures in NextGen had to degrade gracefully."}),"\n",(0,i.jsx)(r.li,{children:"Teams needed observability to prove routing decisions in real traffic."}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"main-risks-covered",children:"Main Risks Covered"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Routing regressions during migration."}),"\n",(0,i.jsx)(r.li,{children:"Hard cutover risk (all-or-nothing releases)."}),"\n",(0,i.jsx)(r.li,{children:"Runtime failures in NextGen breaking user journeys."}),"\n",(0,i.jsx)(r.li,{children:"Operational blind spots (not knowing why a request went legacy vs NextGen)."}),"\n",(0,i.jsx)(r.li,{children:"Fragmented data behavior between old and new renderers."}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"architectural-approach",children:"Architectural Approach"}),"\n",(0,i.jsxs)(r.p,{children:["The solution uses a route-level resolver (",(0,i.jsx)(r.code,{children:"resolveRouteController"}),") that composes both worlds behind the same path."]}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Hapi keeps owning route registration and legacy controllers."}),"\n",(0,i.jsx)(r.li,{children:"Resolver checks feature-flag and path eligibility."}),"\n",(0,i.jsx)(r.li,{children:"If eligible, it delegates to a React Router handler adapted to Hapi request/response."}),"\n",(0,i.jsx)(r.li,{children:"If not eligible, it serves legacy immediately."}),"\n",(0,i.jsx)(r.li,{children:"If NextGen fails, it falls back to legacy path safely."}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"This avoids dual public endpoints, keeps migration localized, and preserves rollback."}),"\n",(0,i.jsx)(r.h2,{id:"end-to-end-request-flow",children:"End-to-End Request Flow"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Request enters Hapi route table."}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"resolveRouteController(...)"})," runs for dual-stack paths."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"shouldUseNextGenRouter(request)"})," evaluates flag + route match + fallback query."]}),"\n",(0,i.jsx)(r.li,{children:"NextGen branch: load React Router server build through Vite middleware mode and respond through the Hapi adapter."}),"\n",(0,i.jsx)(r.li,{children:"Legacy branch: execute legacy controller handler directly."}),"\n",(0,i.jsx)(r.li,{children:"Decision and reason are emitted to routing events for debugging and auditability."}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"key-files-entry-point-to-runtime",children:"Key Files (Entry Point to Runtime)"}),"\n",(0,i.jsxs)(r.p,{children:["All files below live in the companion runtime repo used by this demo (",(0,i.jsx)(r.a,{href:"https://github.com/cromagnoli/hybrid-routing-demo",children:(0,i.jsx)(r.code,{children:"hybrid-routing-demo"})}),")."]}),"\n",(0,i.jsx)(r.h3,{id:"1-route-registration-entry",children:"1) Route registration entry"}),"\n",(0,i.jsx)(qe,{path:"server/init/routes.mjs",href:"https://github.com/cromagnoli/hybrid-routing-demo/blob/60d7d5c2cc758aa17bcd65da18c4cb81fbc56614/server/init/routes.mjs#L10"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:'const routes = [\n  {\n    method: "GET",\n    path: "/cdp/{productCategory}/{productName}/{productId}/",\n    config: cdp.get,\n  },\n  {\n    method: "GET",\n    path: "/pdp/{productCategory}/{productName}/{productId}/",\n    config: routing.resolveRouteController(\n      pdp.getLegacy,\n      "/pdp/{productCategory}/{productName}/{productId}/"\n    ),\n  },\n  {\n    method: "GET",\n    path: "/checkout/{productId}/",\n    config: checkout.get,\n  },\n  {\n    method: ["GET", "POST"],\n    path: "/{path*}",\n    config: routing.resolveRouteController(fallback.unmatched, "/{path*}"),\n  },\n];\n'})}),"\n",(0,i.jsx)(r.admonition,{title:"Why it matters",type:"note",children:(0,i.jsxs)(r.p,{children:["Only dual-stack routes use ",(0,i.jsx)(r.code,{children:"resolveRouteController()"}),"; legacy-only routes keep direct controllers."]})}),"\n",(0,i.jsx)(r.h3,{id:"2-core-hybrid-resolver",children:"2) Core hybrid resolver"}),"\n",(0,i.jsxs)(r.h4,{id:"21-main-entry-point-resolveroutecontroller",children:["2.1) Main entry point (",(0,i.jsx)(r.code,{children:"resolveRouteController"}),")"]}),"\n",(0,i.jsx)(qe,{path:"server/app/hybrid-routing/routing.mjs",href:"https://github.com/cromagnoli/hybrid-routing-demo/blob/60d7d5c2cc758aa17bcd65da18c4cb81fbc56614/server/app/hybrid-routing/routing.mjs#L99"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:'export const resolveRouteController = (legacyController, pathDebugId) => ({\n  ...legacyController,\n  handler: async (...handlerArgs) => {\n    try {\n      const [request] = handlerArgs;\n\n      if (shouldUseNextGenRouter(request)) {\n        const reactRouterRoutesHandler = await getReactRouterRoutesHandler(request);\n\n        return reactRouterRoutesHandler(...handlerArgs);\n      }\n\n      if (typeof legacyController.handler === "function") {\n        return legacyController.handler(...handlerArgs);\n      }\n\n      throw new Error("Handler is undefined for legacyController");\n    } catch (error) {\n      return notFound.handler(...handlerArgs);\n    }\n  },\n});\n'})}),"\n",(0,i.jsx)(r.h4,{id:"22-eligibility-gate-used-by-the-resolver",children:"2.2) Eligibility gate used by the resolver"}),"\n",(0,i.jsx)(r.admonition,{title:"Feature-flag route metadata (conceptual)",type:"note",children:(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:'// In production, this route allowlist is controlled by the feature-flag platform.\n// For demo purposes, we keep it local and explicit.\nconst NEXTGEN_ENABLED_ROUTES = ["ProductDetail"];\n'})})}),"\n",(0,i.jsx)(qe,{path:"server/app/hybrid-routing/routing.mjs",href:"https://github.com/cromagnoli/hybrid-routing-demo/blob/60d7d5c2cc758aa17bcd65da18c4cb81fbc56614/server/app/hybrid-routing/routing.mjs"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:'const shouldUseNextGenRouter = (request) => {\n  const hasLegacyFallbackQuery = request?.url?.searchParams?.get("legacy");\n\n  if (hasLegacyFallbackQuery) {\n    return false;\n  }\n\n  const context = parseContext(request);\n  const isPathAvailable = isNextGenPathAvailable(request.path, NEXTGEN_ENABLED_ROUTES);\n\n  // ...\n  return isNextGenRoutingEnabled(context) && isPathAvailable;\n};\n'})}),"\n",(0,i.jsxs)(r.admonition,{type:"note",children:[(0,i.jsxs)(r.mdxAdmonitionTitle,{children:["Why ",(0,i.jsx)(r.code,{children:"hasLegacyFallbackQuery"})," matters"]}),(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"?legacy=true"})," is an explicit operator/support override. It short-circuits NextGen eligibility and guarantees a deterministic fallback path when rollback is needed without redeploying."]})]}),"\n",(0,i.jsx)(r.admonition,{title:"Why it matters",type:"note",children:(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"resolveRouteController"})," is the core entry point. ",(0,i.jsx)(r.code,{children:"shouldUseNextGenRouter"})," is a focused dependency used only to decide eligibility."]})}),"\n",(0,i.jsx)(r.admonition,{type:"note",children:(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"ProductDetail"})," is a route key (not a URL literal). It maps to the declarative path contract in ",(0,i.jsx)(r.code,{children:"paths.mjs"}),", and in production this enablement metadata is typically sourced from the feature-flag tool."]})}),"\n",(0,i.jsx)(r.h3,{id:"3-hapi--react-router-adapter",children:"3) Hapi \u2194 React Router adapter"}),"\n",(0,i.jsx)(r.h4,{id:"31-runtime-handler-bridge",children:"3.1) Runtime handler bridge"}),"\n",(0,i.jsx)(qe,{path:"server/app/hybrid-routing/routing.mjs",href:"https://github.com/cromagnoli/hybrid-routing-demo/blob/60d7d5c2cc758aa17bcd65da18c4cb81fbc56614/server/app/hybrid-routing/routing.mjs"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:"const createReactRouterRoutesHandler = async (request) => {\n  const build = await getViteBuild();\n\n  return createRequestHandler({\n    build,\n    getLoadContext: async () => ({\n      request,\n    }),\n  });\n};\n\nexport const getReactRouterRoutesHandler = async (request) => {\n  return await createReactRouterRoutesHandler(request);\n};\n"})}),"\n",(0,i.jsx)(r.admonition,{title:"Why it matters",type:"note",children:(0,i.jsxs)(r.p,{children:["This is the runtime bridge used by ",(0,i.jsx)(r.code,{children:"resolveRouteController"})," to defer NextGen handler creation until a request is actually eligible."]})}),"\n",(0,i.jsx)(r.admonition,{type:"note",children:(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"getLoadContext"})," is the per-request context portal. It is where Hapi runtime data is injected into React Router loaders/actions (session, request metadata, feature state, and any cross-layer runtime contract)."]})}),"\n",(0,i.jsx)(r.h4,{id:"32-hapi-requestresponse-adapter",children:"3.2) Hapi request/response adapter"}),"\n",(0,i.jsx)(qe,{path:"server/app/hybrid-routing/react-router-request-response.adapter.mjs",href:"https://github.com/cromagnoli/hybrid-routing-demo/blob/60d7d5c2cc758aa17bcd65da18c4cb81fbc56614/server/app/hybrid-routing/react-router-request-response.adapter.mjs#L42"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:"export const createRequestHandler = ({ build, getLoadContext, mode = process.env.NODE_ENV }) => {\n  const handleRequest = createReactRouterRequestHandler(build, mode);\n\n  return async (hapiReq, h) => {\n    const request = createReactRouterRequest(hapiReq);\n    const loadContext = await getLoadContext?.(hapiReq, h);\n    const response = await handleRequest(request, loadContext);\n\n    return await sendReactRouterResponse(h, response);\n  };\n};\n"})}),"\n",(0,i.jsx)(r.admonition,{title:"Why it matters",type:"note",children:(0,i.jsx)(r.p,{children:"This makes NextGen runtime pluggable without replacing Hapi server infrastructure."})}),"\n",(0,i.jsx)(r.h3,{id:"4-vite-runtime-service-layer",children:"4) Vite runtime service layer"}),"\n",(0,i.jsx)(qe,{path:"server/app/hybrid-routing/vite.mjs",href:"https://github.com/cromagnoli/hybrid-routing-demo/blob/60d7d5c2cc758aa17bcd65da18c4cb81fbc56614/server/app/hybrid-routing/vite.mjs#L35"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:'let vite = null;\n\nconst viteDevServerSingleton = async () => {\n  if (!vite) {\n    vite = await createViteServer();\n  }\n  return vite;\n};\n\nexport const getViteDevServer = viteDevServerSingleton;\n\nexport const getViteBuild = async () => {\n  if (shouldRunViteDevServer()) {\n    const viteDevServer = await getViteDevServer();\n\n    return await viteDevServer.ssrLoadModule("virtual:react-router/server-build");\n  }\n\n  const viteStaticBuild = await import("../../build/server/index.mjs");\n\n  return viteStaticBuild.importBuild();\n};\n'})}),"\n",(0,i.jsx)(r.admonition,{title:"Why it matters",type:"note",children:(0,i.jsx)(r.p,{children:"Singleton lifecycle avoids per-request boot cost and keeps dev/prod demo behavior deterministic."})}),"\n",(0,i.jsx)(r.admonition,{title:"Demo scope",type:"note",children:(0,i.jsx)(r.p,{children:"The companion demo runtime intentionally runs only the Vite dev-server branch for simplicity. The static-build branch is shown here to preserve the full production control-flow shape."})}),"\n",(0,i.jsx)(r.h3,{id:"5-route-capability-map",children:"5) Route capability map"}),"\n",(0,i.jsx)(qe,{path:"server/app/hybrid-routing/paths.mjs",href:"https://github.com/cromagnoli/hybrid-routing-demo/blob/60d7d5c2cc758aa17bcd65da18c4cb81fbc56614/server/app/hybrid-routing/paths.mjs#L1"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:'const DualPaths = {\n  ProductDetail: "/pdp/:productCategory/:productName/:productId",\n};\n\nconst InternalPaths = {\n  ReactRouterManifest: "/__manifest",\n};\n'})}),"\n",(0,i.jsx)(r.admonition,{title:"Why it matters",type:"note",children:(0,i.jsx)(r.p,{children:"An explicit allowlist of dual-stack pages prevents accidental routing to NextGen for pages under migration that are not yet production-ready."})}),"\n",(0,i.jsx)(r.h2,{id:"resilience-design",children:"Resilience Design"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Safe fallback path always exists (legacy controller)."}),"\n",(0,i.jsxs)(r.li,{children:["Fallback can be user-forced (",(0,i.jsx)(r.code,{children:"?legacy=true"}),") for incidents and support workflows."]}),"\n",(0,i.jsx)(r.li,{children:"Runtime failures in NextGen are contained and redirected without losing the journey."}),"\n",(0,i.jsx)(r.li,{children:"Wildcard fallback route guarantees unknown paths still resolve predictably."}),"\n",(0,i.jsxs)(r.li,{children:["Routing event logs explain decision reason (",(0,i.jsx)(r.code,{children:"nextgen-active"}),", ",(0,i.jsx)(r.code,{children:"feature-flag-off"}),", ",(0,i.jsx)(r.code,{children:"forced-by-query"}),", etc.)."]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"resilience-in-code",children:"Resilience in Code"}),"\n",(0,i.jsx)(r.h4,{id:"1-explicit-operator-fallback-short-circuit",children:"1) Explicit operator fallback short-circuit"}),"\n",(0,i.jsx)(qe,{path:"server/app/hybrid-routing/routing.mjs",href:"https://github.com/cromagnoli/hybrid-routing-demo/blob/60d7d5c2cc758aa17bcd65da18c4cb81fbc56614/server/app/hybrid-routing/routing.mjs#L146"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:'const shouldUseNextGenRouter = (request) => {\n  const hasLegacyFallbackQuery = request?.url?.searchParams?.get("legacy");\n\n  if (hasLegacyFallbackQuery) {\n    return false;\n  }\n\n  // ...\n};\n'})}),"\n",(0,i.jsx)(r.admonition,{title:"Why it matters",type:"note",children:(0,i.jsx)(r.p,{children:"This guarantees deterministic rollback behavior from the edge of the routing decision, before modern runtime execution begins."})}),"\n",(0,i.jsx)(r.h4,{id:"2-nextgen-runtime-failure-boundary---legacy-redirect",children:"2) NextGen runtime failure boundary -> legacy redirect"}),"\n",(0,i.jsx)(qe,{path:"nextgen-app/app/routes/pdp.tsx",href:"https://github.com/cromagnoli/hybrid-routing-demo/blob/60d7d5c2cc758aa17bcd65da18c4cb81fbc56614/nextgen-app/app/routes/pdp.tsx#L102"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-tsx",children:'const redirectToLegacyFromBoundary = () => {\n  const url = new URL(window.location.href);\n  url.searchParams.set("legacy", "true");\n  url.searchParams.set("fallbackReason", "error-boundary");\n  window.location.assign(url.toString());\n};\n\nclass RedirectToLegacyBoundary extends React.Component {\n  static getDerivedStateFromError() {\n    return { hasError: true };\n  }\n\n  componentDidCatch() {\n    redirectToLegacyFromBoundary();\n  }\n}\n'})}),"\n",(0,i.jsx)(r.admonition,{title:"Why it matters",type:"note",children:(0,i.jsx)(r.p,{children:"If modern rendering fails at runtime, users are automatically moved to the legacy path instead of getting a dead-end error screen."})}),"\n",(0,i.jsx)(r.h2,{id:"why-javascript-no-typescript-in-this-case",children:"Why JavaScript (No TypeScript) in This Case"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"The source system being represented is legacy-first and JS-based."}),"\n",(0,i.jsxs)(r.li,{children:["Preserving ",(0,i.jsx)(r.code,{children:".mjs"})," keeps parity with real migration constraints (team tooling, runtime conventions, file contracts)."]}),"\n",(0,i.jsx)(r.li,{children:"The goal of this case study is architectural fidelity, not a language rewrite."}),"\n",(0,i.jsx)(r.li,{children:"A TypeScript conversion can be a future step, but it is intentionally decoupled from rollout-risk mitigation."}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"product-value",children:"Product Value"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Lower migration risk with zero URL churn."}),"\n",(0,i.jsx)(r.li,{children:"Faster incremental delivery by page/path, not by platform rewrite."}),"\n",(0,i.jsx)(r.li,{children:"Better reliability posture through graceful degradation."}),"\n",(0,i.jsx)(r.li,{children:"Easier stakeholder confidence: behavior is testable live with visible logs and HTML payload inspection."}),"\n",(0,i.jsx)(r.li,{children:"Clear rollback strategy without deployment rollback (immediate traffic rollback)."}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"performance-notes",children:"Performance Notes"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"In dev environments, the singleton NextGen runtime avoids repeated startup overhead across requests."}),"\n",(0,i.jsx)(r.li,{children:"Routing checks are lightweight string/path matching plus feature-state checks."}),"\n",(0,i.jsx)(r.li,{children:"Legacy remains direct path for non-enabled pages, so migration does not tax unrelated routes."}),"\n",(0,i.jsx)(r.li,{children:"Adapter avoids duplicate server stacks by reusing current Hapi transport surface."}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"live-demo",children:"Live Demo"}),"\n",(0,i.jsx)(r.h3,{id:"how-to-run-the-experience",children:"How to Run the Experience"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"The iframe starts on a legacy category page."}),"\n",(0,i.jsx)(r.li,{children:"Click the product tile to open product detail."}),"\n",(0,i.jsxs)(r.li,{children:["Use ",(0,i.jsx)(r.code,{children:"NextGen ON/OFF"})," switch, then click browser ",(0,i.jsx)(r.code,{children:"Reload"})," to apply the current renderer."]}),"\n",(0,i.jsxs)(r.li,{children:["Use ",(0,i.jsx)(r.code,{children:"Trigger failure"})," in NextGen PDP to validate automatic fallback behavior."]}),"\n",(0,i.jsxs)(r.li,{children:["Use ",(0,i.jsx)(r.code,{children:"Live Server Data Editing (REST)"})," and reload to prove both renderers consume the same source of truth."]}),"\n",(0,i.jsxs)(r.li,{children:["Inspect ",(0,i.jsx)(r.code,{children:"Current iframe HTML"})," and ",(0,i.jsx)(r.code,{children:"Server Log"})," to verify renderer ownership and routing reason."]}),"\n"]}),"\n",(0,i.jsx)(Ce,{})]})}function Ue(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(De,{...e})}):De(e)}},467(e,r,t){function n(e,r,t,n,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void t(e)}s.done?r(l):Promise.resolve(l).then(n,i)}function i(e){return function(){var r=this,t=arguments;return new Promise(function(i,a){var o=e.apply(r,t);function s(e){n(o,i,a,s,l,"next",e)}function l(e){n(o,i,a,s,l,"throw",e)}s(void 0)})}}t.d(r,{A:()=>i})},2444(e,r,t){function n(e,r,t,i){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,r,t,i){function o(r,t){n(e,r,function(e){return this._invoke(r,t,e)})}r?a?a(e,r,{value:t,enumerable:!i,configurable:!i,writable:!i}):e[r]=t:(o("next",0),o("throw",1),o("return",2))},n(e,r,t,i)}function i(){var e,r,t="function"==typeof Symbol?Symbol:{},a=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function s(t,i,a,o){var s=i&&i.prototype instanceof c?i:c,d=Object.create(s.prototype);return n(d,"_invoke",function(t,n,i){var a,o,s,c=0,d=i||[],u=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(r,t){return a=r,o=0,s=e,h.n=t,l}};function p(t,n){for(o=t,s=n,r=0;!u&&c&&!i&&r<d.length;r++){var i,a=d[r],p=h.p,m=a[2];t>3?(i=m===n)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=t<2&&p<a[1])?(o=0,h.v=n,h.n=a[1]):p<m&&(i=t<3||a[0]>n||n>m)&&(a[4]=t,a[5]=n,h.n=m,o=0))}if(i||t>1)return l;throw u=!0,n}return function(i,d,m){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&p(d,m),o=d,s=m;(r=o<2?e:s)||!u;){a||(o?o<3?(o>1&&(h.n=-1),p(o,s)):h.n=s:h.v=s);try{if(c=2,a){if(o||(i="next"),r=a[i]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,o<2&&(o=0)}else 1===o&&(r=a.return)&&r.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=e}else if((r=(u=h.n<0)?s:t.call(n,h))!==l)break}catch(r){a=e,o=1,s=r}finally{c=1}}return{value:r,done:u}}}(t,a,o),!0),d}var l={};function c(){}function d(){}function u(){}r=Object.getPrototypeOf;var h=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),p=u.prototype=c.prototype=Object.create(h);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,n(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return d.prototype=u,n(p,"constructor",u),n(u,"constructor",d),d.displayName="GeneratorFunction",n(u,o,"GeneratorFunction"),n(p),n(p,o,"Generator"),n(p,a,function(){return this}),n(p,"toString",function(){return"[object Generator]"}),(i=function(){return{w:s,m:m}})()}t.d(r,{A:()=>i})},8453(e,r,t){t.d(r,{R:()=>o,x:()=>s});var n=t(6540);const i={},a=n.createContext(i);function o(e){const r=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);