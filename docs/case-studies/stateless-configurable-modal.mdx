
import EditProductModal from '@site/src/components/edit-product-modal/components/edit-product-modal';
import { useEditProductModalDemo } from '@site/src/components/demo-modal/use-edit-product-modal-demo';
import mockData, { highVolumeEditingItem, highVolumeModalMockData } from '@site/src/components/demo-modal/mockData';
import Pill from '@site/src/components/stub-ui-library/pill/pill';
import { EditProductErrorNotification, EditProductWarningNotification, EditProductPrimaryButton, EditProductSecondaryCta } from '@site/src/components/edit-product-modal/components/partials';
import LiveJsxPlayground from '@site/src/components/live-jsx-playground/live-jsx-playground';

export const firstSku = mockData.skuVariants.availableSkus[0];

export const demoItem = {
  productName: mockData.productSummary.displayName,
  productUrl: `/products/${mockData.productSummary.productId}`,
  imageUrl: mockData.skuVariants.imagesByColorCode[firstSku.colorCode][0],
  colorCode: firstSku.colorCode,
  size: firstSku.size,
};

export const secondSku =
    mockData.skuVariants.availableSkus.find(
        (sku) => sku.colorCode === '444444' && sku.size === '11'
    ) ?? mockData.skuVariants.availableSkus[1];

export const demoItemAlt = {
  productName: mockData.productSummary.displayName,
  productUrl: `/products/${mockData.productSummary.productId}`,
  imageUrl: mockData.skuVariants.imagesByColorCode[secondSku.colorCode][0],
  colorCode: secondSku.colorCode,
  size: secondSku.size,
};

export const notifyMeSku =
    mockData.skuVariants.availableSkus.find(
        (sku) => sku.colorCode === 'ffffff' && sku.size === '11'
    ) ?? mockData.skuVariants.availableSkus[1];

export const demoItemNotifyMe = {
  productName: mockData.productSummary.displayName,
  productUrl: `/products/${mockData.productSummary.productId}`,
  imageUrl: mockData.skuVariants.imagesByColorCode[notifyMeSku.colorCode][0],
  colorCode: notifyMeSku.colorCode,
  size: notifyMeSku.size,
};

export const defaultScenarioPlaygroundCode = `() => {
  const {
    imageUrl,
    colorCode,
    onDismiss,
    handleAddToBagClick,
    handleNavigateProductDetails,
    initialSize,
    productName,
    skuVariants,
  } = useEditProductModalDemo({
    editingItem: initializationData.editingItem,
    onModalDismiss: () => {},
    mockModalData: skuCombinationsResponse,
  });

  return (
    <EditProductModal
      mainHeading={productName}
      productName={productName}
      initialImageUrl={imageUrl}
      initialColorCode={colorCode}
      initialSize={initialSize}
      skuVariants={skuVariants}
      onDismiss={onDismiss}
      renderPrimaryCta={({ isCurrentSkuAvailable, currentMatchingSku }) => (
        <EditProductPrimaryButton
          label="Add to cart"
          disabled={!isCurrentSkuAvailable}
          onClick={() => handleAddToBagClick(currentMatchingSku)}
        />
      )}
      renderSecondaryCta={({ currentMatchingSku }) => (
        <EditProductSecondaryCta
          label="Go to product overview"
          onClick={() => handleNavigateProductDetails(currentMatchingSku)}
        />
      )}
      renderAfterHeading={() => <Pill>NEW</Pill>}
    />
  );
}`;

export const defaultScenarioInitializationCode = `(() => {
  const colorCode = "ffffff";
  const size = "10";

  return {
    editingItem: {
      // Demo shortcut: initializationData reads from skuCombinationsResponse in this playground context.
      productName: skuCombinationsResponse.productSummary.displayName,
      productUrl: "/products/" + skuCombinationsResponse.productSummary.productId,
      imageUrl: skuCombinationsResponse.skuVariants.imagesByColorCode[colorCode][0],
      colorCode,
      size,
    },
  };
})()`;

export const defaultScenarioPlaygroundDataCode = `{
  productSummary: {
    productId: "${mockData.productSummary.productId}",
    displayName: "BuyMeNot Sneakers",
  },
  skuVariants: {
    colors: [
      { colorCode: "ffffff", displayName: "White", available: true },
      { colorCode: "444444", displayName: "Graphite", available: true },
    ],
    sizes: [
      { size: "10", available: true },
      { size: "11", available: true },
      { size: "12", available: true },
    ],
    availableSkus: [
      { id: "1", colorCode: "ffffff", size: "10", listPrice: "128.00", salePrice: "98.00", available: true },
      { id: "2", colorCode: "ffffff", size: "11", listPrice: "128.00", available: false },
      { id: "3", colorCode: "ffffff", size: "12", listPrice: "128.00", available: true },
      { id: "4", colorCode: "444444", size: "10", listPrice: "128.00", available: false },
      { id: "5", colorCode: "444444", size: "11", listPrice: "128.00", available: true },
      { id: "6", colorCode: "444444", size: "12", listPrice: "128.00", available: true },
    ],
    imagesByColorCode: {
      "ffffff": [...mockData.skuVariants.imagesByColorCode["ffffff"]],
      "444444": [...mockData.skuVariants.imagesByColorCode["444444"]],
    },
  },
}`;

export const highVolumeScenarioPlaygroundCode = `() => {
  const {
    imageUrl,
    colorCode,
    onDismiss,
    handleAddToBagClick,
    handleNavigateProductDetails,
    initialSize,
    productName,
    skuVariants,
  } = useEditProductModalDemo({
    editingItem: initializationData.editingItem,
    onModalDismiss: () => {},
    mockModalData: skuCombinationsResponse,
  });

  return (
    <EditProductModal
      mainHeading={productName}
      productName={productName}
      initialImageUrl={imageUrl}
      initialColorCode={colorCode}
      initialSize={initialSize}
      skuVariants={skuVariants}
      onDismiss={onDismiss}
      renderPrimaryCta={({ isCurrentSkuAvailable, currentMatchingSku }) => (
        <EditProductPrimaryButton
          label="Add to cart"
          disabled={!isCurrentSkuAvailable}
          onClick={() => handleAddToBagClick(currentMatchingSku)}
        />
      )}
      renderSecondaryCta={({ currentMatchingSku }) => (
        <EditProductSecondaryCta
          label="Go to product overview"
          onClick={() => handleNavigateProductDetails(currentMatchingSku)}
        />
      )}
    />
  );
}`;

export const highVolumeScenarioPlaygroundDataCode = `${JSON.stringify(highVolumeModalMockData, null, 2)}`;

export const highVolumeScenarioInitializationCode = `(() => {
  const colorCode = "22c55e";
  const size = "6.5";

  return {
    editingItem: {
      // Demo shortcut: initializationData reads from skuCombinationsResponse in this playground context.
      productName: skuCombinationsResponse.productSummary.displayName,
      productUrl: "/products/" + skuCombinationsResponse.productSummary.productId,
      imageUrl: skuCombinationsResponse.skuVariants.imagesByColorCode[colorCode][0],
      colorCode,
      size,
    },
  };
})()`;

export const secondScenarioPlaygroundCode = `() => {
  const {
    imageUrl,
    colorCode,
    onDismiss,
    handleAddToBagClick,
    handleNavigateProductDetails,
    initialSize,
    productName,
    skuVariants,
  } = useEditProductModalDemo({
    editingItem: initializationData.editingItem,
    onModalDismiss: () => {},
    mockModalData: skuCombinationsResponse,
  });

  return (
    <EditProductModal
      mainHeading={productName}
      productName={productName}
      initialImageUrl={imageUrl}
      initialColorCode={colorCode}
      initialSize={initialSize}
      skuVariants={skuVariants}
      onDismiss={onDismiss}
      renderPrimaryCta={({ isCurrentSkuAvailable, currentMatchingSku }) => (
        <EditProductPrimaryButton
          label="Add to cart"
          disabled={!isCurrentSkuAvailable}
          onClick={() => handleAddToBagClick(currentMatchingSku)}
        />
      )}
      renderSecondaryCta={({ currentMatchingSku }) => (
        <EditProductSecondaryCta
          label="Go to product overview"
          onClick={() => handleNavigateProductDetails(currentMatchingSku)}
        />
      )}
      renderNotifications={({ isCurrentSkuAvailable, currentMatchingSkuId }) => (
        <>
          <EditProductWarningNotification visible={currentMatchingSkuId === "5"}>
            Hurry up! Limited units remaining!
          </EditProductWarningNotification>
          <EditProductErrorNotification visible={!isCurrentSkuAvailable}>
            Sold out. Please select another combination.
          </EditProductErrorNotification>
        </>
      )}
    />
  );
}`;

export const secondScenarioInitializationCode = `(() => {
  const colorCode = "444444";
  const size = "11";

  return {
    editingItem: {
      // Demo shortcut: initializationData reads from skuCombinationsResponse in this playground context.
      productName: skuCombinationsResponse.productSummary.displayName,
      productUrl: "/products/" + skuCombinationsResponse.productSummary.productId,
      imageUrl: skuCombinationsResponse.skuVariants.imagesByColorCode[colorCode][0],
      colorCode,
      size,
    },
  };
})()`;

export const notifyMeScenarioPlaygroundCode = `() => {
  const {
    imageUrl,
    colorCode,
    onDismiss,
    initialSize,
    productName,
    skuVariants,
  } = useEditProductModalDemo({
    editingItem: initializationData.editingItem,
    onModalDismiss: () => {},
    mockModalData: skuCombinationsResponse,
  });

  return (
    <EditProductModal
      mainHeading={productName}
      productName={productName}
      initialImageUrl={imageUrl}
      initialColorCode={colorCode}
      initialSize={initialSize}
      skuVariants={skuVariants}
      onDismiss={onDismiss}
      renderNotifications={({ isCurrentSkuAvailable }) => (
        <EditProductErrorNotification visible={!isCurrentSkuAvailable}>
          Sold out. Get notified or browse similar in-stock options.
        </EditProductErrorNotification>
      )}
      renderPrimaryCta={({ isCurrentSkuAvailable }) => (
        <EditProductPrimaryButton
          label={isCurrentSkuAvailable ? "Add to cart" : "Notify me when available"}
          disabled={false}
          onClick={() =>
            isCurrentSkuAvailable
              ? alert("Added to cart!")
              : alert("Back-in-stock notification registered!")
          }
        />
      )}
      renderSecondaryCta={({ isCurrentSkuAvailable }) => (
        <EditProductSecondaryCta
          label={isCurrentSkuAvailable ? "Go to product overview" : "See similar in-stock"}
          onClick={() =>
            isCurrentSkuAvailable
              ? alert("Navigating to product overview")
              : alert("Opening similar in-stock options for selected size")
          }
        />
      )}
    />
  );
}`;

export const notifyMeScenarioInitializationCode = `(() => {
  const colorCode = "ffffff";
  const size = "11";

  return {
    editingItem: {
      // Demo shortcut: initializationData reads from skuCombinationsResponse in this playground context.
      productName: skuCombinationsResponse.productSummary.displayName,
      productUrl: "/products/" + skuCombinationsResponse.productSummary.productId,
      imageUrl: skuCombinationsResponse.skuVariants.imagesByColorCode[colorCode][0],
      colorCode,
      size,
    },
  };
})()`;

export const afterSelectorsScenarioPlaygroundCode = `() => {
  const {
    imageUrl,
    colorCode,
    onDismiss,
    handleAddToBagClick,
    handleNavigateProductDetails,
    initialSize,
    productName,
    skuVariants,
  } = useEditProductModalDemo({
    editingItem: initializationData.editingItem,
    onModalDismiss: () => {},
    mockModalData: skuCombinationsResponse,
  });

  return (
    <EditProductModal
      mainHeading={productName}
      productName={productName}
      initialImageUrl={imageUrl}
      initialColorCode={colorCode}
      initialSize={initialSize}
      skuVariants={skuVariants}
      onDismiss={onDismiss}
      renderPrimaryCta={({ isCurrentSkuAvailable, currentMatchingSku }) => (
        <EditProductPrimaryButton
          label="Add to cart"
          disabled={!isCurrentSkuAvailable}
          onClick={() => handleAddToBagClick(currentMatchingSku)}
        />
      )}
      renderSecondaryCta={({ currentMatchingSku }) => (
        <EditProductSecondaryCta
          label="Go to product overview"
          onClick={() => handleNavigateProductDetails(currentMatchingSku)}
        />
      )}
      renderAfterAttrsSelectors={({ currentSizeDetails }) => (
        <small className="subtle-attention-text">
          Model is wearing size {currentSizeDetails?.size ?? "11"}.
        </small>
      )}
    />
  );
}`;

export const afterSelectorsScenarioInitializationCode = `(() => {
  const colorCode = "444444";
  const size = "11";

  return {
    editingItem: {
      // Demo shortcut: initializationData reads from skuCombinationsResponse in this playground context.
      productName: skuCombinationsResponse.productSummary.displayName,
      productUrl: "/products/" + skuCombinationsResponse.productSummary.productId,
      imageUrl: skuCombinationsResponse.skuVariants.imagesByColorCode[colorCode][0],
      colorCode,
      size,
    },
  };
})()`;

# Stateless Configurable Modal

This demo showcases a stateless, configurable modal architecture using
derived availability logic and render prop injection.

> Note: This modal's visual styles were adjusted to work inline inside documentation.  
> The production implementation used a different presentation and should not be inferred from this demo styling.  
> External dependencies that are not accessible in this environment are lightly stubbed for demo purposes.  
> Data fetching is mocked for demonstration, and latency is simulated with a timer.

---

<div className="demoSection">
  <h3>Default Behavior</h3>
  <small className="subtle-attention-text">Resize to see responsive behavior from mobile through desktop.</small>
  <LiveJsxPlayground
    title="Default Scenario Playground"
    initialCode={defaultScenarioPlaygroundCode}
    initialInitializationCode={defaultScenarioInitializationCode}
    initialDataCode={defaultScenarioPlaygroundDataCode}
    initializationVarName="initializationData"
    initializationTitle="Initialization Data"
    dataVarName="skuCombinationsResponse"
    dataTitle="Product Variants Response"
    scope={{
      EditProductModal,
      useEditProductModalDemo,
      EditProductPrimaryButton,
      EditProductSecondaryCta,
      Pill,
      mockData,
    }}
  />
</div>

<div className="demoSection">
  <h3>Low Stock Custom Notification and Logic</h3>
  <small className="subtle-attention-text">Resize to see responsive behavior from mobile through desktop.</small>
  <LiveJsxPlayground
    title="Low Stock Custom Notification and Logic Playground"
    initialCode={secondScenarioPlaygroundCode}
    initialInitializationCode={secondScenarioInitializationCode}
    initialDataCode={defaultScenarioPlaygroundDataCode}
    initializationVarName="initializationData"
    initializationTitle="Initialization Data"
    dataVarName="skuCombinationsResponse"
    dataTitle="Product Variants Response"
  scope={{
    EditProductModal,
    useEditProductModalDemo,
    EditProductPrimaryButton,
    EditProductSecondaryCta,
    EditProductWarningNotification,
    EditProductErrorNotification,
    mockData,
    }}
  />
</div>

<div className="demoSection">
  <h3>Notify-Me Fallback CTA</h3>
  <small>When selection is out of stock, primary switches from disabled Add to cart to an active Notify me flow.</small>
  <LiveJsxPlayground
    title="Notify-Me Fallback CTA Playground"
    initialCode={notifyMeScenarioPlaygroundCode}
    initialInitializationCode={notifyMeScenarioInitializationCode}
    initialDataCode={defaultScenarioPlaygroundDataCode}
    initializationVarName="initializationData"
    initializationTitle="Initialization Data"
    dataVarName="skuCombinationsResponse"
    dataTitle="Product Variants Response"
    scope={{
      EditProductModal,
      useEditProductModalDemo,
      EditProductPrimaryButton,
      EditProductSecondaryCta,
      EditProductErrorNotification,
      mockData,
    }}
  />
</div>

<div className="demoSection">
  <h3>After Selectors Context Copy</h3>
  <small>Uses `renderAfterAttrsSelectors` to inject contextual copy based on the selected size.</small>
  <LiveJsxPlayground
    title="After Selectors Context Copy Playground"
    initialCode={afterSelectorsScenarioPlaygroundCode}
    initialInitializationCode={afterSelectorsScenarioInitializationCode}
    initialDataCode={defaultScenarioPlaygroundDataCode}
    initializationVarName="initializationData"
    initializationTitle="Initialization Data"
    dataVarName="skuCombinationsResponse"
    dataTitle="Product Variants Response"
    scope={{
      EditProductModal,
      useEditProductModalDemo,
      EditProductPrimaryButton,
      EditProductSecondaryCta,
      mockData,
    }}
  />
</div>

<div className="demoSection">
  <h3>High-Volume Options Demo</h3>
  <small>Fake fetch with 12 colors x 25 sizes (US 5.0-9.5, then whole sizes 10-24) to stress selector overflow and composition.</small>
  <LiveJsxPlayground
    title="High-Volume Scenario Playground"
    initialCode={highVolumeScenarioPlaygroundCode}
    initialDataCode={highVolumeScenarioPlaygroundDataCode}
    initialInitializationCode={highVolumeScenarioInitializationCode}
    dataVarName="skuCombinationsResponse"
    dataTitle="Product Variants Response"
    initializationVarName="initializationData"
    initializationTitle="Initialization Data"
    scope={{
       EditProductModal,
       useEditProductModalDemo,
       EditProductPrimaryButton,
       EditProductSecondaryCta
    }}
  />
</div>

<div className="demoSection">
  <h3>Loading State Demo (Forced for demo)</h3>
  <small>
    Available information is rendered immediately, while the section that depends on remote data is hidden until the response arrives and that part can be fully composed. Because users already have content to scan, they begin engaging right away, which reduces perceived waiting time and lowers anxiety about loading delays.
  </small>
  <EditProductModal
    mainHeading="BuyMeNot Sneakers"
    productName="BuyMeNot Sneakers"
    initialImageUrl={mockData.skuVariants.imagesByColorCode[firstSku.colorCode][0]}
    initialColorCode={null}
    initialSize={null}
    initialListPrice={firstSku.listPrice}
    initialSalePrice={firstSku.salePrice}
    skuVariants={{}}
    onDismiss={() => {}}
  />
</div>

<div className="demoSection">
  <h3>Loading Variant: Missing Core Display Context</h3>
  <small>
    This variant intentionally omits image, heading, product name, color and size to show the fallback loading shell when the consumer has almost no initial context.
  </small>
  <EditProductModal
    mainHeading=""
    productName=""
    initialImageUrl={null}
    initialColorCode={firstSku.colorCode}
    initialSize={firstSku.size}
    initialListPrice={null}
    initialSalePrice={null}
    skuVariants={{}}
    onDismiss={() => {}}
  />
</div>
